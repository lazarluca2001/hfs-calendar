<script>
    const monthSelect = document.getElementById('monthSelect');
    const calendar = document.getElementById('calendar');
    const months = ["Január", "Február", "Március", "Április", "Május", "Június", "Július", "Augusztus", "Szeptember", "Október", "November", "December"];
    const weekdays = ["Hétfő", "Kedd", "Szerda", "Csütörtök", "Péntek", "Szombat", "Vasárnap"];

    // IDE MÁSOLD BE A GOOGLE TÁBLÁZATBÓL KAPOTT CSV LINKEKET
    const urls = {
        esemenyek: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSDDBNbIkZize7hPMfYPovbLgnIFWNuseLg0mjzDYGhLCwEEiF_-CiXnV76lgg2mvb54QabZ8y3Sork/pub?gid=338581218&single=true&output=csv',
        szulinapok: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSDDBNbIkZize7hPMfYPovbLgnIFWNuseLg0mjzDYGhLCwEEiF_-CiXnV76lgg2mvb54QabZ8y3Sork/pub?gid=689836805&single=true&output=csv'
    };

    let naptarAdatok = [];

    // CSV szöveg átalakítása tömbbé
    function csvToJSON(csv) {
        const lines = csv.split('\n');
        const result = [];
        const headers = lines[0].split(',');

        for (let i = 1; i < lines.length; i++) {
            const obj = {};
            const currentline = lines[i].split(',');
            headers.forEach((h, index) => {
                obj[h.trim()] = currentline[index]?.trim();
            });
            result.push(obj);
        }
        return result;
    }

    async function adatokBetoltese() {
        try {
            // Mindkét táblázat letöltése egyszerre
            const [resEsemeny, resSzulinap] = await Promise.all([
                fetch(urls.esemenyek).then(r => r.text()),
                fetch(urls.szulinapok).then(r => r.text())
            ]);

            const esemenyLista = csvToJSON(resEsemeny);
            const szulinapLista = csvToJSON(resSzulinap);

            // Itt összefésüljük az adatokat egy közös listába
            naptarAdatok = [...esemenyLista, ...szulinapLista];
            
            renderCalendar(parseInt(monthSelect.value));
        } catch (e) {
            console.error("Hiba az adatok betöltésekor. Ellenőrizd a linkeket!", e);
            renderCalendar(parseInt(monthSelect.value)); // Hiba esetén is rajzolja ki az üres naptárat
        }
    }

    function renderCalendar(monthIndex) {
        calendar.innerHTML = '';
        weekdays.forEach(day => {
            const div = document.createElement('div');
            div.className = 'weekday-header';
            div.textContent = day;
            calendar.appendChild(div);
        });

        const year = 2026;
        let firstDay = new Date(year, monthIndex, 1).getDay();
        firstDay = firstDay === 0 ? 6 : firstDay - 1; 
        const daysInMonth = new Date(year, monthIndex + 1, 0).getDate();

        for (let i = 0; i < firstDay; i++) {
            calendar.appendChild(Object.assign(document.createElement('div'), {className: 'day empty'}));
        }

        for (let day = 1; day <= daysInMonth; day++) {
            const dayDiv = document.createElement('div');
            dayDiv.className = 'day';
            
            // Megkeressük az adott naphoz tartozó adatokat a táblázatból
            // Feltételezzük, hogy a táblázatban van egy 'Datum' oszlop ÉÉÉÉ-HH-NN formátumban
            const maiDatum = `${year}-${String(monthIndex + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const napiInfok = naptarAdatok.filter(sor => sor.Datum === maiDatum);

            let infoHTML = '';
            napiInfok.forEach(info => {
                // Ha van 'Esemeny' vagy 'Nev' oszlop, megjelenítjük
                const szoveg = info.Esemeny || info.Nev || "";
                infoHTML += `<div class="event-slot">${szoveg}</div>`;
            });

            dayDiv.innerHTML = `<div class="day-number">${day}</div>${infoHTML}`;
            calendar.appendChild(dayDiv);
        }
    }

    // Inicializálás
    months.forEach((month, index) => {
        let opt = document.createElement('option');
        opt.value = index;
        opt.textContent = month;
        monthSelect.appendChild(opt);
    });

    monthSelect.addEventListener('change', (e) => renderCalendar(parseInt(e.target.value)));
    
    // Indításkor adatok betöltése
    adatokBetoltese();
</script>
